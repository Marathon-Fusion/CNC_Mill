; Move to RELATIVE Z position 
; Created by Cohen Weston on August 26, 2025
; Modified by Cohen Weston on August 26, 2025

M400

; Snapshot current user positions and soft limits
var zCur = move.axes[2].userPosition
var zMin = move.axes[2].min
var zMax = move.axes[2].max

M291 P"Move to RELATIVE Z position (relative to CURRENT position)?" S3 J2
if result == -1
  abort "Move cancelled"

else
  ; Compute safe relative bounds so soft limits cannot be exceeded
  var zLow = var.zMin - var.zCur
  var zHigh = var.zMax - var.zCur

  ; Z Δ
  M291 R"ΔZ" P{"Enter Z offset (mm). Default = 0<br>Allowed values: " ^ {var.zLow} ^ " to " ^ {var.zHigh}} S6 F0 L{var.zLow} H{var.zHigh} J2
  if result == -1
    abort "Move cancelled"
  var dz = input

  ; Feedrate (mm/min)
  M291 R"Feedrate" P"Enter F in mm/min" S5 F3000 L1 J2
  if result == -1
    abort "Move cancelled"
  var feedR = input

  G94
  G91 G1 Z{var.dz} F{var.feedR}
